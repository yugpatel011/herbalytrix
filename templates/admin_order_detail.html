{% extends "base.html" %}
{% block content %}

<h2>Order #{{ order.id }}</h2>

<p style="font-size:0.9rem;color:#4b5563;margin-bottom:0.8rem;">
    Placed on {{ order.created_at.strftime("%d-%m-%Y %H:%M") }}
</p>

<div class="flex" style="gap:1.5rem;flex-wrap:wrap;">

    <!-- Left: customer & shipping -->
    <div style="flex:1;min-width:260px;">
        <h3 style="font-size:1rem;margin-bottom:0.4rem;">Customer</h3>
        <p style="margin:0.1rem 0;"><strong>Name:</strong> {{ order.customer_name }}</p>
        {% if order.email %}
        <p style="margin:0.1rem 0;"><strong>Email:</strong> {{ order.email }}</p>
        {% endif %}
        <p style="margin:0.1rem 0;"><strong>Phone:</strong> {{ order.phone }}</p>

        <h3 style="font-size:1rem;margin:0.8rem 0 0.3rem;">Shipping address</h3>
        <p style="margin:0.1rem 0;white-space:pre-line;">{{ order.address }}</p>
        <p style="margin:0.1rem 0;">{{ order.city }} – {{ order.pincode }}</p>

        <h3 style="font-size:1rem;margin:0.8rem 0 0.3rem;">Order status</h3>
        <form method="post" action="{{ url_for('admin_order_status', order_id=order.id) }}"
              style="max-width:220px;">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"><!--  -->

            <label for="status">Update status</label>
            <select id="status" name="status">
                <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="packed" {% if order.status == 'packed' %}selected{% endif %}>Packed</option>
                <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>Shipped</option>
            </select>
            <button class="btn btn-primary" type="submit" style="margin-top:0.4rem;">
                Save status
            </button>
        </form>

        <p style="margin-top:0.8rem;font-weight:600;">
            Total amount: ₹{{ order.total_amount }}
        </p>

        <div style="margin-top:0.6rem;">
            <a href="{{ url_for('admin_orders') }}" class="btn btn-secondary">Back to orders</a>
        </div>
    </div>

    <!-- Right: items -->
    <div style="flex:1.1;min-width:260px;">
        <h3 style="font-size:1rem;margin-bottom:0.4rem;">Items</h3>

        {% if order.items %}
        <table>
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Qty</th>
                    <th>Price (₹)</th>
                    <th>Subtotal (₹)</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items %}
                <tr>
                    <td>{{ item.product.name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.unit_price }}</td>
                    <td>{{ item.unit_price * item.quantity }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>No items found for this order.</p>
        {% endif %}
    </div>
</div>

{% endblock %}
