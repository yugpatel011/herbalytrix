{% extends "base.html" %}
{% block content %}
<h2>Your Cart</h2>

{% if not items %}
<p>Your cart is empty.</p>
<a class="btn btn-secondary" href="{{ url_for('home') }}">Continue shopping</a>
{% else %}
<div class="table-responsive">
<table >
    <thead>
        <tr>
            <th>Product</th>
            <th>Qty</th>
            <th>Price (₹)</th>
            <th>Subtotal (₹)</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for product, qty, subtotal in items %}
        <tr>
            <td>{{ product.name }}</td>
            <td>
                <form method="post" style="display:inline-flex;gap:0.3rem;align-items:center;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                    <input type="hidden" name="product_id" value="{{ product.id }}">
                    <input type="hidden" name="action" value="update">
                    <input name="quantity" type="number" min="1" max="{{ product.stock }}" value="{{ qty }}"
                           style="max-width:70px;">
                    <button class="btn btn-secondary" type="submit" style="padding:0.25rem 0.7rem;font-size:0.75rem;">
                        Update
                    </button>
                </form>
            </td>
            <td>{{ product.price }}</td>
            <td>{{ subtotal }}</td>
            <td>
                <form method="post">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                    <input type="hidden" name="product_id" value="{{ product.id }}">
                    <input type="hidden" name="action" value="remove">
                    <button class="btn btn-secondary" type="submit" style="padding:0.25rem 0.7rem;font-size:0.75rem;">
                        Remove
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
<p style="margin-top:1rem;font-weight:600;">Total: ₹{{ total }}</p>

<div style="margin-top:1rem;display:flex;gap:0.5rem;flex-wrap:wrap;">
    <a href="{{ url_for('home') }}" class="btn btn-secondary">Continue shopping</a>
    <a href="{{ url_for('checkout') }}" class="btn btn-primary">Checkout</a>
</div>
{% endif %}
{% endblock %}
